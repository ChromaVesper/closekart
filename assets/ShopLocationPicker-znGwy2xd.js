import{c as B,r as n,j as e,S as U,M as P}from"./index-D9ZxZFog.js";import{M as R,T as $,a as G,L as V,u as _,b as q}from"./TileLayer-Baa5QNNU.js";import{C as H}from"./check-DHEezEo9.js";import{L as p}from"./loader-AOluj3RN.js";import{X as W}from"./x-Bq1Od0fT.js";import{N as X}from"./navigation-DHiCXfcb.js";import{B as J,H as K}from"./hash-CxgJJ1yX.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=B("Earth",[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3v0a2 2 0 0 1 2 2v0c0 1.1.9 2 2 2v0a2 2 0 0 0 2-2v0c0-1.1.9-2 2-2h3.17",key:"1fi5u6"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2v0a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"xsiumc"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=B("Landmark",[["line",{x1:"3",x2:"21",y1:"22",y2:"22",key:"j8o0r"}],["line",{x1:"6",x2:"6",y1:"18",y2:"11",key:"10tf0k"}],["line",{x1:"10",x2:"10",y1:"18",y2:"11",key:"54lgf6"}],["line",{x1:"14",x2:"14",y1:"18",y2:"11",key:"380y"}],["line",{x1:"18",x2:"18",y1:"18",y2:"11",key:"1kevvc"}],["polygon",{points:"12 2 20 7 4 7",key:"jkujk7"}]]),te=()=>V.divIcon({className:"",html:`<div style="
            width:40px;height:40px;
            background:linear-gradient(135deg,#6366f1,#4f46e5);
            border:3px solid white;
            border-radius:50% 50% 50% 0;
            transform:rotate(-45deg);
            box-shadow:0 6px 18px rgba(99,102,241,.5);
            position:relative;">
            <div style="
                position:absolute;inset:0;
                display:flex;align-items:center;justify-content:center;
                transform:rotate(45deg);">
                <div style="width:9px;height:9px;background:white;border-radius:50%;"></div>
            </div>
        </div>`,iconSize:[40,40],iconAnchor:[20,40]}),se=({center:l})=>{const i=_();return n.useEffect(()=>{l&&i.flyTo(l,i.getZoom(),{duration:.8})},[l,i]),null},ae=({onMapClick:l})=>(q({click:i=>l(i.latlng)}),null),re=async(l,i)=>{try{const a=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${l}&lon=${i}&format=json&addressdetails=1`)).json(),r=a.address||{};return{fullAddress:a.display_name||`${l.toFixed(5)}, ${i.toFixed(5)}`,city:r.city||r.town||r.village||r.county||"",state:r.state||"",pincode:r.postcode||""}}catch{return{fullAddress:`${l.toFixed(5)}, ${i.toFixed(5)}`,city:"",state:"",pincode:""}}},ge=({onSave:l,onCancel:i,locked:o=!1,savedLocation:a=null})=>{var A,E;const[r,c]=n.useState({lat:20.5937,lng:78.9629}),[D,f]=n.useState(null),[m,S]=n.useState(!1),[y,b]=n.useState(!1),[j,C]=n.useState(!1),[x,v]=n.useState(""),[z,g]=n.useState([]),[I,M]=n.useState(!1),[F,k]=n.useState(""),[d,u]=n.useState({fullAddress:"",landmark:"",city:"",state:"",pincode:""}),T=n.useRef(te()),N=n.useRef(null),w=n.useRef(null);n.useEffect(()=>{o||navigator.geolocation&&navigator.geolocation.getCurrentPosition(({coords:t})=>{const s={lat:t.latitude,lng:t.longitude};c(s),f([s.lat,s.lng])},()=>{})},[o]),n.useEffect(()=>{if(!o)return clearTimeout(N.current),N.current=setTimeout(async()=>{S(!0);const t=await re(r.lat,r.lng);u(s=>({...s,fullAddress:t.fullAddress,city:t.city,state:t.state,pincode:t.pincode})),S(!1)},700),()=>clearTimeout(N.current)},[r.lat,r.lng,o]),n.useEffect(()=>{if(!x.trim()||x.length<3){g([]);return}return clearTimeout(w.current),w.current=setTimeout(async()=>{M(!0);try{const t=await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(x)}&format=json&limit=5`);g(await t.json())}catch{g([])}finally{M(!1)}},400),()=>clearTimeout(w.current)},[x]);const Z=t=>{const s={lat:parseFloat(t.lat),lng:parseFloat(t.lon)};c(s),f([s.lat,s.lng]),v(""),g([])},L=()=>{if(!navigator.geolocation){k("Geolocation not supported.");return}b(!0),k(""),navigator.geolocation.getCurrentPosition(({coords:t})=>{const s={lat:t.latitude,lng:t.longitude};c(s),f([s.lat,s.lng]),b(!1)},()=>{k("Location permission denied. Move the pin manually."),b(!1)})},O=async()=>{!d.fullAddress||m||(C(!0),await l({...d,latitude:r.lat,longitude:r.lng}),C(!1))};return o&&a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4 bg-green-50 border border-green-200 rounded-2xl p-5",children:[e.jsx(H,{size:28,className:"text-green-600 shrink-0 mt-0.5"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-bold text-green-800 text-base",children:"Location locked âœ“"}),e.jsx("p",{className:"text-sm text-green-700 mt-1 break-words",children:a.fullAddress}),a.landmark&&e.jsxs("p",{className:"text-xs text-green-600 mt-0.5",children:["Landmark: ",a.landmark]}),e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-green-600 flex-wrap",children:[a.city&&e.jsxs("span",{children:["ðŸ™ ",a.city]}),a.state&&e.jsxs("span",{children:["ðŸ“ ",a.state]}),a.pincode&&e.jsxs("span",{children:["ðŸ“® ",a.pincode]})]}),e.jsxs("p",{className:"text-xs font-mono text-green-500 mt-2",children:[(A=a.latitude)==null?void 0:A.toFixed(5),", ",(E=a.longitude)==null?void 0:E.toFixed(5)]})]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-2xl p-4 text-xs text-amber-800",children:[e.jsx("strong",{children:"Shop location is locked and cannot be edited."})," Contact support for changes."]}),e.jsx("div",{style:{height:200,borderRadius:16,overflow:"hidden",border:"1px solid #e5e7eb"},children:e.jsxs(R,{center:[a.latitude,a.longitude],zoom:16,style:{height:"100%",width:"100%"},zoomControl:!1,dragging:!1,scrollWheelZoom:!1,doubleClickZoom:!1,children:[e.jsx($,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(G,{position:[a.latitude,a.longitude],icon:T.current})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:I?e.jsx(p,{size:14,className:"animate-spin"}):e.jsx(U,{size:14})}),e.jsx("input",{value:x,onChange:t=>v(t.target.value),placeholder:"Search area, street, landmarkâ€¦",className:"w-full pl-9 pr-9 py-2.5 text-sm border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-400 bg-white"}),x&&e.jsx("button",{onClick:()=>{v(""),g([])},className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(W,{size:13})})]}),z.length>0&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl shadow-lg overflow-hidden max-h-[140px] overflow-y-auto -mt-2",children:z.map((t,s)=>e.jsxs("button",{onClick:()=>Z(t),className:"w-full text-left px-3 py-2 hover:bg-indigo-50 text-xs text-gray-700 border-b border-gray-50 last:border-0 flex items-start gap-2",children:[e.jsx(P,{size:12,className:"text-gray-400 mt-0.5 shrink-0"}),e.jsx("span",{className:"line-clamp-2",children:t.display_name})]},s))}),e.jsxs("button",{onClick:L,disabled:y,className:"flex items-center gap-2 text-xs font-semibold text-indigo-600 hover:text-indigo-700 disabled:opacity-50",children:[y?e.jsx(p,{size:13,className:"animate-spin"}):e.jsx(X,{size:13}),y?"Detecting GPSâ€¦":"Use my current GPS location"]}),F&&e.jsx("p",{className:"text-xs text-red-500",children:F}),e.jsxs("div",{style:{height:300,borderRadius:16,overflow:"hidden",border:"1px solid #e5e7eb",position:"relative"},children:[e.jsxs(R,{center:[r.lat,r.lng],zoom:15,style:{height:"100%",width:"100%"},zoomControl:!0,children:[e.jsx($,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'Â© <a href="https://osm.org/copyright">OpenStreetMap</a>'}),e.jsx(se,{center:D}),e.jsx(ae,{onMapClick:({lat:t,lng:s})=>c({lat:t,lng:s})}),e.jsx(G,{position:[r.lat,r.lng],draggable:!0,icon:T.current,eventHandlers:{dragend:t=>{const{lat:s,lng:Q}=t.target.getLatLng();c({lat:s,lng:Q})}}})]}),e.jsx("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 z-[1000] bg-white/90 backdrop-blur-sm text-xs text-gray-600 px-3 py-1.5 rounded-full shadow pointer-events-none font-medium",children:"Drag pin or tap to reposition"})]}),e.jsxs("div",{className:"bg-indigo-50 border border-indigo-100 rounded-xl p-3 flex items-start gap-2",children:[m?e.jsx(p,{size:14,className:"text-indigo-400 animate-spin mt-0.5 shrink-0"}):e.jsx(P,{size:14,className:"text-indigo-600 mt-0.5 shrink-0"}),e.jsx("p",{className:"text-xs text-gray-700 line-clamp-3",children:m?"Getting addressâ€¦":d.fullAddress||"Move the pin to set location"})]}),e.jsxs("p",{className:"text-xs font-mono text-gray-400 text-center",children:[r.lat.toFixed(5),", ",r.lng.toFixed(5)]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx(h,{label:"Landmark (optional)",icon:ee,value:d.landmark,onChange:t=>u(s=>({...s,landmark:t})),placeholder:"Near City Mall, Opp. Parkâ€¦"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(h,{label:"City",icon:J,value:d.city,onChange:t=>u(s=>({...s,city:t})),placeholder:"Mumbai"}),e.jsx(h,{label:"State",icon:Y,value:d.state,onChange:t=>u(s=>({...s,state:t})),placeholder:"Maharashtra"}),e.jsx(h,{label:"Pincode",icon:K,value:d.pincode,onChange:t=>u(s=>({...s,pincode:t})),placeholder:"400001"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[i&&e.jsx("button",{onClick:i,className:"flex-1 border border-gray-200 text-gray-600 py-3 rounded-xl text-sm font-medium hover:bg-gray-50 transition",children:"Back"}),e.jsxs("button",{onClick:O,disabled:j||m||!d.fullAddress,className:"flex-1 bg-indigo-600 text-white py-3 rounded-xl text-sm font-bold hover:bg-indigo-700 disabled:opacity-50 transition flex items-center justify-center gap-2",children:[j?e.jsx(p,{size:15,className:"animate-spin"}):e.jsx(H,{size:15}),j?"Savingâ€¦":"Confirm & Lock Shop Location"]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-100 rounded-xl px-4 py-3 text-xs text-amber-700",children:["âš ï¸ Location will be ",e.jsx("strong",{children:"locked permanently"})," after saving. Buyers within your delivery radius will see your shop."]})]})},h=({label:l,icon:i,value:o,onChange:a,placeholder:r})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 mb-1",children:l}),e.jsxs("div",{className:"relative",children:[i&&e.jsx(i,{size:13,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:o,onChange:c=>a(c.target.value),placeholder:r,className:"w-full border border-gray-200 rounded-xl py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400 transition bg-white pl-8 pr-3"})]})]});export{ge as default};
