import{j as e,L as M,M as E,r as n,a as S,e as R,d as $,S as P}from"./index-H1pFEOJk.js";import{P as L}from"./ProductCard-C39dsij1.js";import{S as z}from"./star-BZtP8WLw.js";import{N as A}from"./navigation-CtJYWTiV.js";import{T as _}from"./truck-BM4klPDl.js";const F=({shop:a})=>{if(!a)return null;const c=a.distanceKm!=null?a.distanceKm:a.distanceMeters!=null?Math.round(a.distanceMeters/100)/10:null;return e.jsx(M,{to:`/shop/${a._id}`,className:"block",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm hover:shadow-md transition-all duration-200 border border-gray-100 overflow-hidden p-4 group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-bold text-base text-gray-900 group-hover:text-blue-600 transition-colors truncate",children:a.shopName}),e.jsx("span",{className:"inline-block text-xs font-medium text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full mt-1",children:a.category})]}),a.rating!=null&&e.jsxs("div",{className:"bg-green-600 text-white text-xs px-2 py-1 rounded-lg flex items-center gap-1 shrink-0 ml-2 font-semibold",children:[a.rating," ",e.jsx(z,{size:10,className:"fill-current"})]})]}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-500 mb-2",children:[e.jsx(E,{size:14,className:"mt-0.5 text-gray-400 shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:a.address})]}),c!=null&&e.jsxs("div",{className:"flex items-center gap-1.5 text-blue-600 text-xs font-semibold mb-2",children:[e.jsx(A,{size:12}),e.jsxs("span",{children:[c," km away"]})]}),a.deliveryAvailable&&e.jsxs("div",{className:"flex items-center gap-1.5 text-green-600 text-xs font-medium",children:[e.jsx(_,{size:12}),e.jsxs("span",{children:["Delivery: ",a.deliveryCharge===0?"Free":`â‚¹${a.deliveryCharge}`]})]}),e.jsx("button",{className:"mt-3 w-full border border-blue-500 text-blue-600 py-1.5 rounded-xl hover:bg-blue-600 hover:text-white transition-all text-sm font-semibold",children:"View Products"})]})})},q=()=>{const[a,c]=n.useState([]),d=n.useRef(null),u=n.useRef([]),{coords:t}=S();return n.useEffect(()=>{const o=document.getElementById("mappls-script"),s="https://apis.mappls.com/advancedmaps/api/8f586cb9e9cc4041f08e7780e1bd8ce1/map_sdk?layer=vector&v=3.0",r=()=>{window.mappls&&!d.current&&(t!=null&&t.latitude)&&(t!=null&&t.longitude)&&(d.current=new window.mappls.Map("map",{center:[t.latitude,t.longitude],zoom:15}))};if(o)r();else{const l=document.createElement("script");l.id="mappls-script",l.src=s,l.async=!0,l.onload=()=>r(),document.body.appendChild(l)}d.current&&window.mappls&&(t!=null&&t.latitude)&&(t!=null&&t.longitude)&&d.current.setCenter({lat:t.latitude,lng:t.longitude})},[t==null?void 0:t.latitude,t==null?void 0:t.longitude]),n.useEffect(()=>{if(!(t!=null&&t.latitude)||!(t!=null&&t.longitude))return;fetch(`https://closekart.onrender.com/api/shops?lat=${t.latitude}&lng=${t.longitude}`).then(s=>s.json()).then(s=>{c(Array.isArray(s)?s:[])}).catch(s=>console.error("Error loading shops:",s))},[t==null?void 0:t.latitude,t==null?void 0:t.longitude]),n.useEffect(()=>{const o=d.current;!o||!window.mappls||(u.current.length&&(u.current.forEach(s=>{try{s.remove()}catch{}}),u.current=[]),!(!a||a.length===0)&&a.forEach(s=>{let r=null,l=null;if(s.latitude&&s.longitude?(r=s.latitude,l=s.longitude):s.location&&Array.isArray(s.location.coordinates)?(l=s.location.coordinates[0],r=s.location.coordinates[1]):s.lat&&s.lng&&(r=s.lat,l=s.lng),r==null||l==null)return;const h=new window.mappls.Marker({map:o,position:{lat:parseFloat(r),lng:parseFloat(l)},title:s.shopName||s.name||"Shop"});u.current.push(h)}))},[a]),e.jsx("div",{id:"map",style:{width:"100%",height:"500px",borderRadius:"12px"}})},V=()=>{const a=R(),{coords:c}=S(),d=new URLSearchParams(a.search),u=d.get("q")||"",t=d.get("category")||"",[o,s]=n.useState(u),[r,l]=n.useState([]),[h,b]=n.useState([]),[m,y]=n.useState("shops"),[k,j]=n.useState(!1),[x,v]=n.useState("list");n.useEffect(()=>{w()},[u,t]);const w=async i=>{i&&i.preventDefault(),j(!0);try{let p="",f={search:o,category:t};c&&(f.lat=c.latitude,f.lng=c.longitude),m==="products"?p="/products":p="/shops";const g=await $.get(p,{params:f});if(l(g.data),m==="shops")b(g.data);else{const C=[...new Map(g.data.map(N=>[N.shop._id,N.shop])).values()];b(C)}}catch(p){console.error("Search error:",p),l([])}finally{j(!1)}};return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-80px)]",children:[e.jsxs("div",{className:"md:hidden flex justify-center border-b bg-white p-2",children:[e.jsx("button",{onClick:()=>v("list"),className:`px-4 py-2 rounded-l-lg border ${x==="list"?"bg-blue-600 text-white":"bg-white text-gray-700"}`,children:"List"}),e.jsx("button",{onClick:()=>v("map"),className:`px-4 py-2 rounded-r-lg border ${x==="map"?"bg-blue-600 text-white":"bg-white text-gray-700"}`,children:"Map"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row flex-1 overflow-hidden relative",children:[e.jsxs("aside",{className:"w-full md:w-80 shrink-0 border-r bg-white flex flex-col z-10",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("input",{value:o,onChange:i=>s(i.target.value),placeholder:"Search...",className:"border rounded px-3 py-2 flex-1"}),e.jsx("button",{onClick:w,className:"bg-blue-600 text-white p-2 rounded",children:e.jsx(P,{size:20})})]}),e.jsxs("div",{className:"flex gap-4 mb-2",children:[e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"type",value:"products",checked:m==="products",onChange:()=>y("products"),className:"mr-2"}),"Products"]}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"radio",name:"type",value:"shops",checked:m==="shops",onChange:()=>y("shops"),className:"mr-2"}),"Shops"]})]})]}),e.jsxs("div",{className:`flex-1 overflow-y-auto p-4 bg-gray-50 ${x==="map"?"hidden md:block":""}`,children:[e.jsxs("h2",{className:"text-sm font-bold text-gray-500 mb-4 px-1",children:[r.length," Results"]}),k?e.jsx("div",{className:"flex justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4",children:[r.map(i=>m==="products"?e.jsx(L,{product:i},i._id):e.jsx(F,{shop:i},i._id)),r.length===0&&e.jsx("p",{className:"text-center text-gray-500 mt-8",children:"No results found."})]})]})]}),e.jsx("main",{className:`flex-1 relative ${x==="list"?"hidden md:block":"block h-full"}`,children:e.jsx(q,{shops:h})})]})]})};export{V as default};
