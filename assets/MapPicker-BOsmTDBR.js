import{r as s,j as e,L as u,S as _,X as q,M,N as B,C as W}from"./index-C7wD4Goi.js";import{M as X,T as Z,d as J,L as K,u as V,f as Y}from"./TileLayer-XizdO_eb.js";const ee=()=>K.divIcon({className:"",html:`
            <div style="
                width: 36px; height: 36px;
                background: #2563eb;
                border: 3px solid white;
                border-radius: 50% 50% 50% 0;
                transform: rotate(-45deg);
                box-shadow: 0 4px 14px rgba(37,99,235,.5);
                position: relative;
            ">
                <div style="
                    position: absolute; inset: 0;
                    display: flex; align-items: center; justify-content: center;
                    transform: rotate(45deg);
                ">
                    <div style="width:8px;height:8px;background:white;border-radius:50%;"></div>
                </div>
            </div>`,iconSize:[36,36],iconAnchor:[18,36],popupAnchor:[0,-38]}),te=({center:a})=>{const r=V();return s.useEffect(()=>{a&&r.flyTo(a,r.getZoom(),{duration:.8})},[a,r]),null},se=({onMapClick:a})=>(Y({click:r=>a(r.latlng)}),null),ae=async(a,r)=>{try{return(await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${a}&lon=${r}&format=json`)).json()).display_name||`${a.toFixed(5)}, ${r.toFixed(5)}`}catch{return`${a.toFixed(5)}, ${r.toFixed(5)}`}},oe=({initialLat:a=20.5937,initialLng:r=78.9629,onSave:j,onCancel:x,label:E="Home",showLabelPicker:F=!0,saveLabel:L="Save Address"})=>{const[o,c]=s.useState({lat:a,lng:r}),[R,w]=s.useState(null),[d,$]=s.useState(""),[g,N]=s.useState(!1),[p,m]=s.useState(!1),[h,S]=s.useState(!1),[k,D]=s.useState(E),[l,b]=s.useState(""),[z,i]=s.useState([]),[P,C]=s.useState(!1),[T,f]=s.useState(""),y=s.useRef(null),A=s.useRef(ee()),v=s.useRef(null);s.useEffect(()=>(clearTimeout(v.current),v.current=setTimeout(async()=>{N(!0);const t=await ae(o.lat,o.lng);$(t),N(!1)},600),()=>clearTimeout(v.current)),[o.lat,o.lng]);const G=()=>{if(!navigator.geolocation){f("Geolocation not supported.");return}m(!0),f(""),navigator.geolocation.getCurrentPosition(({coords:t})=>{const n={lat:t.latitude,lng:t.longitude};c(n),w([n.lat,n.lng]),m(!1)},()=>{f("Location permission denied. Move the pin manually."),m(!1)})};s.useEffect(()=>{if(!l.trim()||l.length<3){i([]);return}return clearTimeout(y.current),y.current=setTimeout(async()=>{C(!0);try{const t=await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(l)}&format=json&limit=5`);i(await t.json())}catch{i([])}finally{C(!1)}},400),()=>clearTimeout(y.current)},[l]);const H=t=>{const n={lat:parseFloat(t.lat),lng:parseFloat(t.lon)};c(n),w([n.lat,n.lng]),b(""),i([])},I=t=>c({lat:t.lat,lng:t.lng}),O=t=>{const{lat:n,lng:U}=t.target.getLatLng();c({lat:n,lng:U})},Q=async()=>{d&&(S(!0),await j({label:k,fullAddress:d,latitude:o.lat,longitude:o.lng}),S(!1))};return e.jsxs("div",{className:"flex flex-col gap-0 bg-white rounded-2xl overflow-hidden border border-gray-200 shadow-lg",children:[e.jsxs("div",{className:"p-3 border-b border-gray-100 bg-gray-50 space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",children:P?e.jsx(u,{size:14,className:"animate-spin"}):e.jsx(_,{size:14})}),e.jsx("input",{value:l,onChange:t=>b(t.target.value),placeholder:"Search area, street, landmark…",className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white"}),l&&e.jsx("button",{onClick:()=>{b(""),i([])},className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(q,{size:13})})]}),z.length>0&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl shadow-md overflow-hidden max-h-[150px] overflow-y-auto",children:z.map((t,n)=>e.jsxs("button",{onClick:()=>H(t),className:"w-full text-left px-3 py-2 hover:bg-blue-50 text-xs text-gray-700 border-b border-gray-50 last:border-0 flex items-start gap-2",children:[e.jsx(M,{size:12,className:"text-gray-400 mt-0.5 shrink-0"}),e.jsx("span",{className:"line-clamp-2",children:t.display_name})]},n))}),e.jsxs("button",{onClick:G,disabled:p,className:"flex items-center gap-2 text-xs font-semibold text-blue-600 hover:text-blue-700 transition disabled:opacity-50",children:[p?e.jsx(u,{size:13,className:"animate-spin"}):e.jsx(B,{size:13}),p?"Detecting GPS…":"Use my current location"]}),T&&e.jsx("p",{className:"text-xs text-red-500",children:T})]}),e.jsxs("div",{className:"relative",style:{height:340},children:[e.jsxs(X,{center:[o.lat,o.lng],zoom:15,style:{height:"100%",width:"100%"},zoomControl:!0,children:[e.jsx(Z,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),e.jsx(te,{center:R}),e.jsx(se,{onMapClick:I}),e.jsx(J,{position:[o.lat,o.lng],draggable:!0,icon:A.current,eventHandlers:{dragend:O}})]}),e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 z-[1000] bg-white/90 backdrop-blur-sm text-xs text-gray-600 px-3 py-1.5 rounded-full shadow font-medium pointer-events-none",children:"Drag the pin or tap to reposition"})]}),e.jsxs("div",{className:"p-3 border-t border-gray-100 space-y-3 bg-white",children:[e.jsxs("div",{className:"flex items-start gap-2 bg-blue-50 border border-blue-100 rounded-xl px-3 py-2.5",children:[g?e.jsx(u,{size:14,className:"text-blue-400 animate-spin mt-0.5 shrink-0"}):e.jsx(M,{size:14,className:"text-blue-600 mt-0.5 shrink-0"}),e.jsx("p",{className:"text-xs text-gray-700 line-clamp-2",children:g?"Getting address…":d||"Move the pin to set location"})]}),F&&e.jsx("div",{className:"flex gap-2",children:["Home","Work","Other"].map(t=>e.jsx("button",{onClick:()=>D(t),className:`flex-1 py-1.5 rounded-xl text-xs font-semibold border transition
                                    ${k===t?"bg-blue-600 text-white border-blue-600":"border-gray-200 text-gray-500 hover:border-gray-300"}`,children:t},t))}),e.jsxs("div",{className:"flex gap-2",children:[x&&e.jsx("button",{onClick:x,className:"flex-1 border border-gray-200 text-gray-600 py-2.5 rounded-xl text-sm font-medium hover:bg-gray-50 transition",children:"Back"}),e.jsxs("button",{onClick:Q,disabled:h||g||!d,className:"flex-1 bg-blue-600 text-white py-2.5 rounded-xl text-sm font-bold hover:bg-blue-700 disabled:opacity-50 transition flex items-center justify-center gap-2",children:[h?e.jsx(u,{size:15,className:"animate-spin"}):e.jsx(W,{size:15}),h?"Saving…":L]})]})]})]})};export{oe as default};
