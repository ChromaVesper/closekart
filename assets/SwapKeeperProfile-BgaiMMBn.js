const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ShopLocationPicker-6eXRyKTu.js","assets/index-H1pFEOJk.js","assets/index-Dx2odOa2.css","assets/TileLayer-ibnEn6wr.js","assets/check-WfTa71Ng.js","assets/loader-BfibaeNG.js","assets/x--GxsgcE7.js","assets/navigation-CtJYWTiV.js","assets/hash-ndORiFgy.js"])))=>i.map(i=>d[i]);
import{c as B,r as o,j as e,k as y,M,U as H,p as K,d as u,_ as q}from"./index-H1pFEOJk.js";import{h as G,i as J}from"./swapKeeperApi-DxjXL8Yh.js";import{I as A}from"./image-CDtkXZLO.js";import{L as U}from"./loader-BfibaeNG.js";import{C as _}from"./check-circle-BH9zKmSx.js";import{P as Q}from"./phone-In70ycPF.js";import{S as W}from"./save-CDdoOQSq.js";import{M as X}from"./map-BGcwYpih.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=B("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),D=o.lazy(()=>q(()=>import("./ShopLocationPicker-6eXRyKTu.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),c=({label:a,icon:n,disabled:s,...m})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:a}),e.jsxs("div",{className:"relative",children:[n&&e.jsx("span",{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-400",children:e.jsx(n,{size:16})}),e.jsx("input",{...m,disabled:s,className:`w-full border border-gray-200 rounded-xl py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition
                    ${n?"pl-10 pr-4":"px-4"}
                    ${s?"bg-gray-50 text-gray-400 cursor-not-allowed":"bg-white"}`})]})]}),b=({icon:a,title:n,subtitle:s})=>e.jsxs("div",{className:"flex items-start gap-3 mb-5",children:[e.jsx("div",{className:"bg-indigo-100 text-indigo-600 p-2.5 rounded-xl shrink-0",children:e.jsx(a,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-gray-900 text-base",children:n}),s&&e.jsx("p",{className:"text-gray-400 text-xs mt-0.5",children:s})]})]}),ne=()=>{var C,P,z,I;const[a,n]=o.useState({shopName:"",ownerName:"",email:"",phone:"",address:"",city:"",state:"",pincode:"",avatar:""}),[s,m]=o.useState(null),[E,F]=o.useState(!0),[j,v]=o.useState(!1),[T,h]=o.useState(!1),[N,x]=o.useState(""),[S,w]=o.useState(""),[k,L]=o.useState(!1);o.useEffect(()=>{(async()=>{try{const[l,r]=await Promise.allSettled([G(),u.get("/swapkeeper/shop")]);if(l.status==="fulfilled"){const t=l.value;n({shopName:t.shopName||"",ownerName:t.ownerName||"",email:t.email||"",phone:t.phone||"",address:t.address||"",city:t.city||"",state:t.state||"",pincode:t.pincode||"",avatar:t.avatar||""})}r.status==="fulfilled"&&m(r.value.data)}catch{x("Failed to load profile")}finally{F(!1)}})()},[]);const d=i=>{const{name:l,value:r}=i.target;n(t=>({...t,[l]:r}))},O=async i=>{i.preventDefault(),v(!0),x(""),h(!1);try{await J(a),h(!0),setTimeout(()=>h(!1),3e3)}catch{x("Failed to update profile")}finally{v(!1)}},R=async i=>{var l,r;try{const t=await u.post("/swapkeeper/save-location",i);m(t.data.shop),w("Shop location saved and locked successfully!"),setTimeout(()=>w(""),4e3)}catch(t){const p=((r=(l=t==null?void 0:t.response)==null?void 0:l.data)==null?void 0:r.msg)||"Failed to save location.";x(p)}},$=async i=>{var r;const l=(r=i.target.files)==null?void 0:r[0];if(l){L(!0);try{const t=new FormData;t.append("file",l);const p=await u.post("/upload",t,{headers:{"Content-Type":"multipart/form-data"}}),f=p.data.url||p.data.filePath||p.data.path||"";f&&(await u.put("/swapkeeper/profile",{shopImage:f}),m(Y=>({...Y,shopImage:f})))}catch{x("Image upload failed. Try again.")}finally{L(!1)}}},g=(s==null?void 0:s.isLocationLocked)===!0,V=g?{fullAddress:(s==null?void 0:s.fullAddress)||"",landmark:(s==null?void 0:s.landmark)||"",city:(s==null?void 0:s.city)||"",state:(s==null?void 0:s.state)||"",pincode:(s==null?void 0:s.pincode)||"",latitude:((P=(C=s==null?void 0:s.location)==null?void 0:C.coordinates)==null?void 0:P[1])||0,longitude:((I=(z=s==null?void 0:s.location)==null?void 0:z.coordinates)==null?void 0:I[0])||0}:null;return E?e.jsx("div",{className:"space-y-6",children:[...Array(3)].map((i,l)=>e.jsx("div",{className:"h-40 bg-gray-100 rounded-2xl animate-pulse"},l))}):e.jsxs("div",{className:"space-y-6 max-w-2xl",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Shop Profile"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Manage your store details, location, and image"})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-6",children:[e.jsx(b,{icon:A,title:"Shop Image",subtitle:"Upload your storefront photo (shown to buyers)"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"w-24 h-24 rounded-2xl bg-indigo-100 flex items-center justify-center overflow-hidden border-2 border-indigo-200 shrink-0",children:s!=null&&s.shopImage?e.jsx("img",{src:s.shopImage,alt:"Shop",className:"w-full h-full object-cover"}):a.avatar?e.jsx("img",{src:a.avatar,alt:"Avatar",className:"w-full h-full object-cover"}):e.jsx(y,{size:32,className:"text-indigo-400"})}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx("p",{className:"font-bold text-gray-900 text-lg",children:a.shopName||"Your Shop"}),e.jsx("p",{className:"text-gray-500 text-sm",children:a.ownerName||"Owner"}),((s==null?void 0:s.city)||a.city)&&e.jsxs("p",{className:"text-gray-400 text-xs flex items-center gap-1",children:[e.jsx(M,{size:11})," ",(s==null?void 0:s.city)||a.city,((s==null?void 0:s.state)||a.state)&&`, ${(s==null?void 0:s.state)||a.state}`]}),e.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer bg-indigo-50 hover:bg-indigo-100 text-indigo-600 text-xs font-semibold px-3 py-2 rounded-xl transition border border-indigo-200",children:[k?e.jsx(U,{size:13,className:"animate-spin"}):e.jsx(A,{size:13}),k?"Uploading…":"Upload Shop Image",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:$})]})]})]})]}),e.jsxs("form",{onSubmit:O,className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-6 space-y-5",children:[e.jsx(b,{icon:y,title:"Store Information",subtitle:"Basic contact and address details"}),N&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-600 rounded-xl px-4 py-3 text-sm",children:N}),T&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 rounded-xl px-4 py-3 text-sm flex items-center gap-2",children:[e.jsx(_,{size:16})," Profile updated!"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(c,{label:"Shop Name",icon:y,type:"text",name:"shopName",value:a.shopName,onChange:d,placeholder:"My Awesome Shop"}),e.jsx(c,{label:"Owner Name",icon:H,type:"text",name:"ownerName",value:a.ownerName,onChange:d,placeholder:"Your full name"}),e.jsx(c,{label:"Email",icon:K,type:"email",name:"email",value:a.email,onChange:d,placeholder:"shop@example.com"}),e.jsx(c,{label:"Phone",icon:Q,type:"tel",name:"phone",value:a.phone,onChange:d,placeholder:"+91 98765 43210"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1.5",children:"Short Address"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3.5 top-3 text-gray-400",children:e.jsx(M,{size:16})}),e.jsx("textarea",{name:"address",value:a.address,onChange:d,placeholder:"Street address, locality...",rows:2,className:"w-full border border-gray-200 rounded-xl pl-10 pr-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400 resize-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(c,{label:"City",type:"text",name:"city",value:a.city,onChange:d,placeholder:"Mumbai"}),e.jsx(c,{label:"State",type:"text",name:"state",value:a.state,onChange:d,placeholder:"Maharashtra"}),e.jsx(c,{label:"Pincode",type:"text",name:"pincode",value:a.pincode,onChange:d,placeholder:"400001"})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsxs("button",{type:"submit",disabled:j,className:"flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-60 text-white px-6 py-2.5 rounded-xl text-sm font-semibold transition shadow-sm",children:[e.jsx(W,{size:16}),j?"Saving…":"Save Changes"]})})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-100 shadow-sm p-6 space-y-4",children:[e.jsx(b,{icon:g?Z:X,title:"Shop Location",subtitle:g?"Location is permanently locked — visible to nearby buyers":"Set your exact shop position so buyers can find you"}),S&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 rounded-xl px-4 py-3 text-sm flex items-center gap-2",children:[e.jsx(_,{size:16})," ",S]}),e.jsx(o.Suspense,{fallback:e.jsx("div",{className:"h-[380px] bg-gray-100 rounded-2xl flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 text-gray-400",children:[e.jsx(U,{size:26,className:"animate-spin text-indigo-400"}),e.jsx("span",{className:"text-sm",children:"Loading map…"})]})}),children:e.jsx(D,{locked:g,savedLocation:V,onSave:R})})]})]})};export{ne as default};
